
现有玩法概览
===========

- 游戏类型：单机（模拟）ACM选手成长模拟器，游戏自动运行（每秒=1 天的模拟时间）。
- 属性分配：游戏开始前玩家有 20 点可分配属性点，每项属性上限为 10。属性分为“通用属性”（如编程、算法、速度、抗压、协作、英语）和“专业属性”（如数学、DP、图论、数据结构、字符串、搜索、贪心、几何）。
- 游戏循环：当游戏处于运行且未暂停状态时，主循环每个时间步会执行：
	- 每天尝试解题（基于属性的成功率做概率判定，成功则计一题并获得固定分数）。
	- 每 5 天自动参加一次竞赛，按属性加权计算比赛得分，并包含随机波动，比赛次数和得分记录在玩家数据中。
- 得分与成长：解题（每日）提供小额分数（当前为固定加分），比赛提供主体得分（基于属性权重 + 随机），累计影响玩家的总分、比赛次数和解题数，从而在排行榜中排名。
- 随机性：比赛得分和解题成功均包含随机或概率成分，使不同属性分配有概率上的差异性和不确定性。
- 控制项：界面提供“开始游戏”“暂停/继续”“重置游戏”等操作；重置会清除进度并回到初始可用属性点。
- 界面呈现：
	- `PlayerPanel`：展示玩家当前属性、剩余属性点、分数、比赛次数、解题数和当前排名；支持通过“+/-”按钮调整属性并显示进度条。
	- `AttributeAllocation`：属性分组（通用 / 专业）与可视化进度条，展示并操作属性点。
	- `GameControls`：启动/暂停/重置与游戏时间/状态显示。
	- `GlobalStatistics`：显示全局玩家统计（总玩家数、平均分、最高分、Top10 排行榜等）。
	- `Notification`：短时弹窗提示比赛/重要事件信息（自动消失）。
- 核心数值要点（玩法相关，不涉及实现细节）：初始可用点数 20、属性上限 10、每 5 天一次比赛、每秒代表 1 天、解题成功概率由多项属性的加权和决定（存在一个用于归一的除数）。
- 数据持久性：当前代码通过内存状态管理排行榜与玩家数据，并未在项目中看到持久化（如本地存储或后端），排行榜数据由 `leaderboardData` 状态承载。

以上为从项目现有代码与组件界面提取的“现有玩法”简要说明（侧重于玩家可见的玩法与规则，不含代码架构设计）。

---

## 设计：按月回合制（仅文档）

目标：将当前自动运行的时间驱动模拟改为“回合制”（每个月为一回合），玩家从大学一年级开始，经过 4 年（共 48 个月）结算，期间所有逻辑由“下一月”操作驱动。

### 一、总体思路
- 每个回合代表 1 个月；玩家从 `month = 1`（大学一年级 1 月）开始。
- 用户通过 UI 触发“下一月”来推进回合；不再依赖自动定时器或 `setInterval`。
- 在每月推进时，按月计算比赛、解题等事件；在第 48 个月之后触发结算并结束游戏。

### 二、数据模型（建议）
- 新增字段：`month`（整数，1..48），代表当前月份。
- 状态字段示例：
	- `isRunning`、`isPaused`（保留）
	- `month`（新增）
	- `availablePoints`、`attributes`、`playerScore`、`playerContests`、`playerProblems`（保留）

### 三、每月事件（逻辑建议）
- 比赛：每月参加一次比赛（或者按需配置频率），调用现有的 `participateInContest(attributes)`，增加 `playerContests` 并累加得分。
- 解题：把“每天一次”的逻辑聚合为“每月多次尝试”，例如每月尝试 8~12 次（可配置），每次调用 `solveProblem(attributes)`，成功则增加 `playerProblems` 和固定分数。
- 随机事件/通知：每月可触发一次通知（比赛、重大事件等），保持现有 `Notification` 使用方式。

### 四、学年与月份显示（UI 变更建议，供开发实现）
- 在 `GameControls` 中增加按钮：`下一月`（调用传入的 `onAdvance()`）。
- 显示格式：`大学 X 年 Y 月`，计算公式：
	- `year = Math.ceil(month / 12)`，范围 1..4
	- `monthInYear = ((month - 1) % 12) + 1`
- `开始游戏` 启动后允许点击 `下一月`；`暂停` 时禁用 `下一月`。

### 五、结算规则
- 当 `month >= 48` 时触发结算：显示最终分数/排名，`isRunning` 设为 `false`，阻止进一步推进。
- 可在结算时展示总比赛次数、总解题数、并提供“重玩”按钮重置 `month` 与其他状态。

### 六、实现指引（给开发者）
- 需要修改的文件（建议，仅作参考）：
	- `src/App.jsx`：将时间推进逻辑从 `useEffect`/`setInterval` 改为 `advanceMonth()`，新增 `month` 字段并在 `start`/`reset` 中初始化。
	- `src/components/GameControls.jsx`：新增 `下一月` 按钮与学年/月份显示，接收 `onAdvance` prop。
	- 其他文件保持事件/函数兼容：`participateInContest`、`solveProblem`、`Notification`。

## 新增：每月行动点与可选活动（顶层设计）

目标：为按月回合引入“行动点（AP）”与“可选活动”系统。每月固定刷新 AP，玩家在当月内用 AP 执行活动；活动会消耗 AP 并产生效果，仅当剩余 AP >= 活动消耗时允许执行。

1) 基本规则
- 每月固定获得 30 点行动点（`monthlyAP = 30`），月初重置 `remainingAP = monthlyAP`。
- 活动以整数 AP 消耗，执行时扣除；AP 不可为负，若消耗 > `remainingAP` 则拒绝执行。
- 活动可见性和可用性随玩家状态（属性、学年/月份、是否已完成特定事件等）动态变化。

2) 活动模板（顶层数据结构）
- 每个活动模板包含：
	- `id`：唯一标识
	- `name`：显示名称
	- `cost`：AP 消耗（整数）
	- `prereq`：先决条件（表达式/函数/描述）
	- `effects`：执行后的效果集合（例：加分、属性增减、问题数增、通知等）
	- `repeatable`：是否可在同一月重复执行（布尔）
	- `visibleIf`：控制活动在 UI 中是否展示（可选）

3) 执行流程（推荐实现逻辑）
- UI 请求执行活动：调用 `executeActivity(activityId)`。
- `executeActivity` 步骤：
	1. 验证 `prereq` 与 `remainingAP >= cost`。
	2. 扣除 `remainingAP -= cost`（原子操作）。
	3. 按 `effects` 应用状态变更（score、attributes、playerProblems、playerContests 等）。
	4. 记录/触发通知，并返回执行结果。

4) 活动示例（示意，不强制实现）
- `刷题`（cost:5）：按 `solveProblem(attributes)` 判定若干次，成功则 `playerProblems++`、`playerScore += 5`。
- `算法训练`（cost:8）：短期提升算法相关效果或属性（例如增加 `attributes.algorithm` 或比赛加成）。
- `模拟赛`（cost:12）：调用 `participateInContest(attributes)`，更新 `playerContests` 与 `playerScore`。
- `休息`（cost:3）：降低 `stress`，提高后续解题成功率。

5) UI 建议
- 在主界面新增 `ActivityPanel`（或扩充 `GameControls`）：显示 `remainingAP`、可见活动清单、每项 `cost` 与简述、执行按钮。
- 当 `remainingAP < cost` 或 `prereq` 未满足时禁用按钮并显示原因。

6) 状态依赖和解锁策略
- 活动可基于属性门槛、学年（月数）、已完成事件等条件解锁。可支持“月度唯一”活动（`repeatable:false`）。

7) 测试点与验收
- 确保 AP 不会变为负值，且 `executeActivity` 在消耗超额时拒绝执行。
- 执行活动后状态（分数、属性、题数、remainingAP）正确更新并反映在 UI 上。

